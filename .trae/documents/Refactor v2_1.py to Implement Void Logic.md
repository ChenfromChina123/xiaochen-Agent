基于对 `void-main`（特别是 `.voidrules`、`issue_triage.py` 和项目结构）的研究，我识别出了可以应用到 `v2_1.py` 的关键 "Void" 原则。注意，由于无法访问核心 TypeScript 源代码（`src/vs/workbench/contrib/void`），逻辑是根据现有配置和规则推导出的。

# 计划：重构 `v2_1.py` 以实现 Void 逻辑

## 1. 核心逻辑增强
- **严格类型与结构**：应用严格的 Python 类型提示和类结构，以执行 `.voidrules` 中发现的“严格类型”规则。
- **命名规范**：采用 `.voidrules` 中指定的 `bOfA` (B of A) 命名规范（例如，使用 `contentOfFile` 而不是 `file_content`）。
- **被动验证**：执行“不要运行任何东西来验证你的更改；告诉用户该做什么”的规则，确保代理默认*建议*命令，而不是在没有明确确认的情况下自动执行。

## 2. 功能增加（代理与自动化）
- **搜索能力**：添加 `search_files` 或 `grep` 工具。`v2_1.py` 目前缺乏探索代码库的能力，这是任何“代理”（Void 主题 5）的关键功能。
- **成本与 Token 管理**：增强 `count_tokens_estimate` 方法以提供更详细的使用统计数据，与 Void 主题 3（提示词、Token 和成本管理）保持一致。

## 3. 配置与环境
- **外部配置**：将硬编码的 API 密钥和 URL 移动到配置文件或环境变量中（主题 6：系统配置）。
- **系统提示词更新**：优化系统提示词以反映新功能和严格规则。

## 4. 实施步骤
1.  **创建 `v2_void.py`**：创建一个新文件来实现这些更改，而不破坏现有的 `v2_1.py`。
2.  **实现服务**：将单体类重构为 `AgentService`、`FileService`、`SearchService`。
3.  **应用规则**：重写逻辑以使用 `bOfA` 命名和严格类型。
4.  **验证**：运行新脚本以确保其正确处理“Void”工作流。